## MODIFIED Requirements

### Requirement: 構造化処理の進捗表示
システムは、構造化処理の進捗状況をユーザーに表示しなければならない（MUST）。書類種別が未判定の場合、構造化処理は開始されず、ステータスは「分類待ち」と表示されなければならない（MUST）。

#### Scenario: 構造化処理中の進捗表示
- **WHEN** システムがPDFの構造化処理を実行中である
- **THEN** 以下の情報を表示する:
  - 現在の処理ステップ（例: テキスト抽出中、項目マッピング中）
  - 処理済みページ数 / 総ページ数
  - 推定残り時間

#### Scenario: 複数ファイルの並列処理進捗
- **WHEN** 複数のPDFファイルが同時に構造化処理される
- **THEN** 各ファイルの個別進捗を表示する
- **AND** 全体の完了状況（例: 2/3ファイル完了）を表示する

#### Scenario: 分類待ち状態の表示
- **WHEN** 書類種別が「未判定」で構造化処理が開始されていない
- **THEN** ステータスを「分類待ち（pending_classification）」と表示する
- **AND** ユーザーに「書類種別を選択してください」というメッセージを表示する
- **AND** 構造化処理の進捗情報は表示しない

## ADDED Requirements

### Requirement: 書類種別による構造化処理の制御
システムは、書類種別が有効（有価証券報告書、統合報告書、決算短信等）に設定されている場合のみ、構造化処理を実行しなければならない（MUST）。書類種別が「未判定（unknown）」または未選択の場合、構造化処理を開始してはならない（MUST NOT）。

#### Scenario: 有効な書類種別での構造化処理開始
- **WHEN** ユーザーが書類種別を「有価証券報告書」に設定する
- **THEN** システムは構造化処理タスクをキューイングする
- **AND** ステータスを「構造化処理中（processing）」に更新する
- **AND** 有価証券報告書のテンプレートを適用して項目マッピングを実行する

#### Scenario: 未判定書類の構造化処理スキップ
- **WHEN** Celeryワーカーが書類種別「未判定」の書類を処理対象として受け取る
- **THEN** システムは構造化処理をスキップする
- **AND** ステータスを「分類待ち（pending_classification）」に設定する
- **AND** 構造化データは生成しない

#### Scenario: 書類種別変更後の再構造化
- **WHEN** ユーザーが既に構造化処理が完了した書類の種別を変更する
- **THEN** システムは既存の構造化データを破棄する
- **AND** 新しい書類種別のテンプレートを使用して構造化処理を再実行する
- **AND** ステータスを「構造化処理中（processing）」に更新する

